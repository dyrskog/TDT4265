\begin{align*}
    \frac{\partial C^n(w)}{\partial w_{k,j}} &= -\frac{\partial}{\partial w_{k,j}} \sum_{p=1}^K y_p^n ln(\hat{y}_p^n) \\
    &= -\frac{\partial}{\partial w_{k,j}} \sum_{p=1}^K y_p^n \left( ln(e^{z_p}) - ln(\sum_{p'}^K e^{z_{p'}})\right) \\
    &= - \sum_{p=1}^K \frac{\partial}{\partial w_{k,j}} y_p^n z_p + \sum_{p=1}^K \frac{\partial}{\partial w_{k,j}} y_p^n ln \left(\sum_{p'}^K e^{z_{p'}}\right)
\end{align*}

\begin{align*}
    \frac{\partial}{\partial w_{k,j}} y_p^n z_p &= \frac{\partial}{\partial w_{k,j}} y_p^n \left( w_p^T x \right) \\
    & = y_p^n \frac{\partial}{\partial w_{k,j}} \sum_j^I w_{p,j} \cdot x_j = \begin{cases}
        0, \quad k \neq p \\
        y_k^n x_j^n, \quad k = p
    \end{cases}\\
\end{align*}

Substituting in for the first term and using the chain rule on the last term, we get:

\begin{align*}
    \frac{\partial C^n(w)}{\partial w_{k,j}} &= -y_k^n x_j^n + \sum_{p=1}^K y_p^n \frac{1}{\sum_{p'}^K e^{z_{p'}}} \frac{\partial}{\partial w_{k,j}}\left(\sum_{p'}^K e^{z_{p'}}\right) \\
\end{align*}

\begin{align*}
    \frac{\partial}{\partial w_{k,j}} e^{z_{p'}} &= \begin{cases}
            0 &, \quad k \neq p' \\
            e^{z_k} \cdot \frac{\partial}{\partial w_{k,j}} w_k x = e^{z_k} x_j &, \quad k = p'
    \end{cases}
\end{align*}

\begin{align*}
    \frac{\partial C^n(w)}{\partial w_{k,j}} &= -y_k^n x_j^n + \sum_{p=1}^K y_p^n \frac{1}{\sum_{p'}^K e^{z_{p'}}} e^{z_k^n} x_j^n\\
    &= -y_k^n x_j^n + \sum_{p=1}^K y_p^n \hat{y}_k^n x_j^n \\
    &= -y_k^n x_j^n + \hat{y}_k^n x_j^n \\
    &= -x_j^n(y_k^n - \hat{y}_k^n)
\end{align*}